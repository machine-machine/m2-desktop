#!/bin/bash

# Clean up any stale X locks
unset SESSION_MANAGER
unset DBUS_SESSION_BUS_ADDRESS

# Set display
export DISPLAY=:1

# Start D-Bus session bus (XFCE requires it)
if [ -z "$DBUS_SESSION_BUS_ADDRESS" ]; then
    eval $(dbus-launch --sh-syntax --exit-with-session)
fi

# Disable XFCE compositor (critical for VNC performance)
xfconf-query -c xfwm4 -p /general/use_compositing -s false 2>/dev/null || true

# Start Plank dock (macOS-style)
plank &

# Start XFCE4 session (exec replaces the shell)
exec startxfce4
