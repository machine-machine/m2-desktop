[supervisord]
nodaemon=true
user=root
logfile=/var/log/supervisord.log
pidfile=/var/run/supervisord.pid
childlogdir=/var/log

# =============================================================================
# D-Bus (required for desktop)
# =============================================================================
[program:dbus]
command=/usr/bin/dbus-daemon --system --nofork
user=root
autorestart=true
priority=5
stdout_logfile=/var/log/dbus.log
stderr_logfile=/var/log/dbus.err

# =============================================================================
# PulseAudio (for audio support)
# =============================================================================
[program:pulseaudio]
command=/usr/bin/pulseaudio --disallow-exit --disallow-module-loading --exit-idle-time=-1
user=developer
autorestart=true
priority=10
environment=HOME="/home/developer",XDG_RUNTIME_DIR="/tmp/runtime-developer"
stdout_logfile=/var/log/pulseaudio.log
stderr_logfile=/var/log/pulseaudio.err

# =============================================================================
# Xvfb (Virtual Framebuffer)
# =============================================================================
[program:xvfb]
command=/usr/bin/Xvfb :0 -screen 0 1920x1080x24 -ac +extension GLX +render -noreset
user=developer
autorestart=true
priority=15
environment=HOME="/home/developer"
stdout_logfile=/var/log/xvfb.log
stderr_logfile=/var/log/xvfb.err

# =============================================================================
# XFCE4 Desktop
# =============================================================================
[program:xfce4]
command=/usr/local/bin/start-desktop.sh
user=developer
autorestart=true
priority=20
startsecs=5
environment=HOME="/home/developer",USER="developer",DISPLAY=":0",XDG_RUNTIME_DIR="/tmp/runtime-developer"
stdout_logfile=/var/log/xfce4.log
stderr_logfile=/var/log/xfce4.err

# =============================================================================
# Selkies-GStreamer WebRTC Server
# =============================================================================
[program:selkies]
command=/bin/bash -c 'sleep 5 && selkies-gstreamer --addr=0.0.0.0 --port=8080 --enable_basic_auth=%(ENV_SELKIES_ENABLE_BASIC_AUTH)s'
user=developer
autorestart=true
priority=30
startsecs=8
environment=HOME="/home/developer",USER="developer",DISPLAY=":0",XDG_RUNTIME_DIR="/tmp/runtime-developer",PULSE_SERVER="unix:/tmp/runtime-developer/pulse/native"
stdout_logfile=/var/log/selkies.log
stderr_logfile=/var/log/selkies.err

# =============================================================================
# Clawdbot Gateway
# =============================================================================
[program:clawdbot-gateway]
command=/bin/bash -c 'sleep 10 && clawdbot gateway --port 18789 --allow-unconfigured'
user=developer
autorestart=true
priority=40
startsecs=5
environment=HOME="/home/developer",USER="developer",DISPLAY=":0",CLAWDBOT_HOME="/clawdbot_home",WORKSPACE="/workspace"
stdout_logfile=/var/log/clawdbot.log
stderr_logfile=/var/log/clawdbot.err
